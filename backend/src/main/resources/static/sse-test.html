<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SSE 좌석 상태 실시간 테스트</title>
    <style>
        .seat {
            display: inline-block;
            width: 30px;
            height: 30px;
            margin: 5px;
            border: 1px solid #333;
            text-align: center;
            line-height: 30px;
            cursor: pointer;
        }
        .available { background-color: #d4edda; } /* 초록색 - 해제됨 */
        .pending { background-color: #fff3cd; }   /* 연노랑 - 예약중 */
        .reserved { background-color: #f8d7da; }  /* 연분홍 - 결제완료 */
        #message {
            margin-top: 10px;
            font-weight: bold;
            color: green;
        }
    </style>
</head>
<body>
<h2>실시간 좌석 상태</h2>
<div id="seat-container">
    <!-- 초기 좌석 -->
    <div class="seat" id="seat-A-1">A1</div>
    <div class="seat" id="seat-A-2">A2</div>
    <div class="seat" id="seat-A-3">A3</div>
    <div class="seat" id="seat-A-4">A4</div>
    <div class="seat" id="seat-A-5">A5</div>
</div>

<div id="message"></div> <!-- 해제 알림 메시지 -->

<script>
    const sessionId = 1;
    const eventSource = new EventSource(`http://localhost:8080/api/areas/subscribe?sessionId=${sessionId}`);

    eventSource.addEventListener("seat-update", (event) => {
        const data = JSON.parse(event.data);
        const row = data.row;
        const number = data.number;
        const statusEnum = data.status; // 예: "PENDING", "RESERVED", null
        const status = statusEnum ? statusEnum.toLowerCase() : "available";

        console.log(`[DEBUG] 좌석 수신: ${row}${number}, 상태: ${statusEnum}`);

        const seatId = `seat-${row}-${number}`;
        let seatElement = document.getElementById(seatId);

        // 없으면 생성
        if (!seatElement) {
            seatElement = document.createElement("div");
            seatElement.classList.add("seat");
            seatElement.id = seatId;
            seatElement.innerText = `${row}${number}`;
            document.getElementById("seat-container").appendChild(seatElement);
        }

        // 상태 반영
        seatElement.classList.remove("pending", "reserved", "available");
        seatElement.classList.add(status);

        // 상태가 available이면 메시지 출력
        const messageBox = document.getElementById("message");
        if (status === "available") {
            messageBox.innerText = `${row}${number} 좌석이 해제되어 선택 가능합니다.`;
            messageBox.style.color = "green";
        } else {
            messageBox.innerText = "";
        }
    });

    eventSource.onerror = (e) => {
        console.error("SSE 연결 오류", e);
    };
</script>
</body>
</html>
